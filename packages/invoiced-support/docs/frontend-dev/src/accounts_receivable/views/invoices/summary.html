<div class="row two-pane">
	<div class="col-sm-4 left-pane">
		<div class="details-list vertical">
			<h4>
				<div class="action" ng-if="('invoices.edit'|hasPermission) && editable" ng-hide="invoice.status == 'voided'">
					<a class="visible-xs" ui-sref="manage.invoice.edit({id:invoice.id})" ng-hide="invoice.closed">
						Edit Invoice
					</a>
				</div>
				Invoice Details
			</h4>

			<!-- Customer -->
			<div>
				<div class="title">Customer</div>
				<div class="value">
					<a ui-sref="manage.customer.view.summary({id:invoice.customer.id})">
						{{invoice.customer.name}}
					</a>
				</div>
			</div>

			<!-- Subscription -->
			<div ng-show="invoice.subscription.plan.name">
				<div class="title">Subscription</div>
				<div class="value">
					<a ui-sref="manage.subscription.view.summary({id:invoice.subscription.id})">
						{{invoice.subscription.plan.name}}
					</a>
				</div>
			</div>

			<!-- Status -->
			<div>
				<div class="title">Status</div>
				<div class="value">
					<invoice-status invoice="invoice"></invoice-status>
				</div>
			</div>

			<!-- Payment Terms -->
			<div ng-if="invoice.payment_terms||invoice.autopay||(!invoice.paid&&!invoice.due_date)">
				<div class="title">Payment Terms</div>
				<div class="value" ng-show="invoice.autopay">
					<span class="label label-success">AutoPay</span>
				</div>
				<div class="value" ng-show="!invoice.autopay&&invoice.payment_terms">
					{{invoice.payment_terms}}
				</div>
				<div class="value" ng-show="!invoice.paid&&!invoice.due_date&&!invoice.payment_terms&&!invoice.autopay">
					<span class="text-danger fas fa-exclamation-triangle"></span>
					No payment terms. Set terms to get paid sooner
					<span ng-if="('invoices.edit'|hasPermission) && editable" ng-hide="invoice.status == 'voided'">
						&mdash;
						<a ui-sref="manage.invoice.edit({id:invoice.id})">
							Edit invoice
						</a>
					</span>
				</div>
			</div>

			<!-- AutoPay Attempts -->
			<div ng-show="invoice.attempt_count">
				<div class="title">AutoPay Attempts</div>
				<div class="value">
					{{invoice.attempt_count}}
				</div>
			</div>

			<!-- Date -->
			<div>
				<div class="title">{{'general.date'|translate}}</div>
				<div class="value">
					<company-date date="invoice.date"></company-date>
				</div>
			</div>

			<!-- Due Date -->
			<div ng-show="invoice.due_date">
				<div class="title">Due On</div>
				<div class="value">
					<company-date date="invoice.due_date"></company-date>
				</div>
			</div>

			<!-- Purchase Order -->
			<div ng-show="invoice.purchase_order">
				<div class="title">Purchase Order</div>
				<div class="value">
					{{invoice.purchase_order}}
				</div>
			</div>

			<!-- Ship To -->
			<div ng-if="invoice.ship_to">
				<div class="title">Ship To</div>
				<div class="value" ng-bind-html="invoice.ship_to|address:true:true:showCountry"></div>
			</div>

			<!-- Tags -->
			<div ng-show="invoice.tags&&invoice.tags.length>0">
				<div class="title">Tags</div>
				<div class="value">
					<span ng-repeat="tag in invoice.tags">
						<span class="invoice-tag">{{tag}}</span>
					</span>
				</div>
			</div>

			<!-- Metadata -->
			<div class="metadata" ng-repeat="(key, value) in invoice.metadata" ng-hide="key=='intacct_invoice_id'||key=='imported_from_intacct'||key=='netsuite_invoice_id'||key=='netsuite_id'||key=='imported_from_netsuite'||key=='quickbooks_invoice_id'||key=='imported_from_quickbooks'||key=='xero_invoice_id'||key=='imported_from_xero'||key=='last_synced'">
				<div class="title"><metadata-name field-id="key" object-type="'invoice'"></metadata-name></div>
				<div class="value">
					<metadata-value field-id="key" object-type="'invoice'" value="value"></metadata-value>
				</div>
			</div>

			<!-- Email Contacts -->
			<div>
				<div ng-if="loaded.delivery && delivery.emails" class="title">Email Contacts</div>
				<div class="value">
					{{delivery.emails.split(',').join(', ')}}
				</div>
			</div>

			<!-- Chasing -->
			<div ng-hide="invoice.paid||(invoice.autopay&&invoice.status!='past_due')||!('legacy_chasing'|hasFeature)||invoice.status=='voided'">
				<div class="title">Chasing</div>
				<div class="value" ng-show="invoice.chase&&!invoice.closed">
					<span class="text-success">Yes</span>
					<span ng-if="'invoices.edit'|hasPermission">
						&mdash;
						<a href="" ng-click="setChase(false,invoice)">
							Stop
						</a>
					</span>
				</div>
				<div class="value" ng-show="!invoice.chase||invoice.closed">
					<span class="text-danger">{{'general.off'|translate}}</span>
					<span ng-hide="invoice.closed" ng-if="'invoices.edit'|hasPermission">
						&mdash;
						<a href="" ng-click="setChase(true,invoice)">
							{{'general.enable'|translate}}
						</a>
					</span>
				</div>
			</div>

			<div ng-show="('legacy_chasing'|hasFeature)&&invoice.chase&&!invoice.paid&&!invoice.closed&&(!invoice.autopay||(invoice.autopay&&invoice.status=='past_due'))">
				<div class="title">Next Follow Up</div>
				<div class="value">
					<div ng-show="invoice.next_chase_on">
						<company-date date="invoice.next_chase_on"></company-date>
						&mdash;
						<a href="" ng-click="scheduleChasing(invoice)">
							Modify
						</a>
					</div>
					<div ng-hide="invoice.next_chase_on">
						<div ng-show="!settings.allow_chasing">
							<span class="text-danger fas fa-exclamation-triangle"></span>
							Account-wide setting is off. Chasing must also be turned on in the <a ui-sref="manage.settings.chasing_legacy">Chasing Settings</a>.
						</div>
						<div ng-show="settings.allow_chasing">
							Not scheduled
							&mdash;
							<a href="" ng-click="scheduleChasing(invoice)">
								Schedule
							</a>
						</div>
					</div>
				</div>
			</div>

			<!-- Late Fees -->
			<div ng-show="invoice.customer.late_fee_schedule && !invoice.closed && !invoice.paid && invoice.status != 'voided'">
				<div class="title">Late Fees</div>
				<div class="value">
					<span class="label label-success" ng-show="invoice.late_fees">{{'general.on'|translate}}</span>
					<span class="label label-danger" ng-hide="invoice.late_fees">{{'general.off'|translate}}</span>
				</div>
			</div>

			<!-- Closed -->
			<div ng-show="invoice.closed && invoice.status != 'voided' && invoice.status != 'bad_debt'">
				<div class="title">Closed</div>
				<div class="value">
					<span class="text-danger">Yes</span>
					<span ng-if="('invoices.edit'|hasPermission) && editable">
						&mdash;
						<a href="" ng-click="setClosed(false, invoice)">
							Reopen
						</a>
					</span>
				</div>
			</div>

			<div ng-show="promiseToPay||(!invoice.paid&&!invoice.closed&&invoice.status!='voided')">
				<div class="title">Expected Payment Date</div>
				<div class="value" ng-show="promiseToPay">
					<company-date date="promiseToPay.date"></company-date>
					<span ng-if="'invoices.edit'|hasPermission">
						&mdash;
						<a href="" ng-click="setPromiseToPay(invoice, promiseToPay)">
							Change
						</a>
					</span>
					<div>
						{{promiseToPay.method|paymentMethodName}}
						<span ng-show="promiseToPay.reference"> # {{promiseToPay.reference}}</span>
					</div>
				</div>
				<div class="value" ng-hide="promiseToPay">
					<em>None</em>
					<span ng-if="'invoices.edit'|hasPermission">
						&mdash;
						<a href="" ng-click="setPromiseToPay(invoice)" ng-if="'invoices.edit'|hasPermission">
							Set
						</a>
					</span>
				</div>
			</div>
		</div>

		<!-- Payment Plan -->
		<div class="panel panel-invoiced light" ng-if="paymentPlan">
			<div class="panel-heading">
				<h4 class="panel-title">
					Payment Plan
					<div class="action" ng-show="invoice.status != 'voided'">
						<automate-button btn-class="'nav-link-item'" object-type="'payment_plan'" object-id="paymentPlan.id"></automate-button>
						<a href="{{invoice.payment_url}}" target="_blank" rel="noopener noreferrer" ng-hide="paymentPlan.status!='pending_signup'||!invoice.payment_url" ng-if="'invoices.edit'|hasPermission">
							Approve
						</a>
						<a href="" ng-click="editPaymentPlan(invoice, paymentPlan)" ng-if="'invoices.edit'|hasPermission">
							Edit
						</a>
						<a href="" class="delete" ng-click="cancelPaymentPlan(invoice)" ng-hide="$parent.deletingPaymentPlan||paymentPlan.status=='finished'" ng-if="'invoices.edit'|hasPermission">
							{{'general.cancel'|translate}}
						</a>
					</div>
				</h4>
				<div ng-show="paymentPlan.status=='pending_signup'">
					<span class="label label-warning">Needs Approval</span>
				</div>
				<div ng-show="paymentPlan.approval">
					<a href="" ng-click="viewApproval(paymentPlan)">
						Approved
						<company-date date="paymentPlan.approval.timestamp"></company-date>
					</a>
				</div>
			</div>
			<table class="table table-striped search-results-table slim payment-plan">
				<thead>
					<tr>
						<th>{{'general.due_date'|translate}}</th>
						<th class="money-column">Amount</th>
						<th class="money-column">{{'general.balance'|translate}}</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="installment in paymentPlan.installments">
						<td>
							<company-date date="installment.date"></company-date>
						</td>
						<td class="money-column hidden-xs">
							<money currency="invoice.currency" amount="installment.amount"></money>
						</td>
						<td class="money-column mobile-last" ng-show="installment.balance > 0">
							<money currency="invoice.currency" amount="installment.balance"></money>
						</td>
						<td class="money-column mobile-last" ng-show="installment.balance == 0">
							<span class="label label-success">Paid</span>
						</td>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- Distribution Settings -->
		<div class="details-list vertical" ng-show="distributions.length > 0">
			<h4>
				Distribution Settings
			</h4>
			<div class="invoice-distribution-settings">
				<div class="distribution" ng-repeat="distribution in distributions">
					<div class="disable">
						<a href="" tooltip="Enable/Disable" ng-click="toggleScheduledTask(distribution)"ng-show="!distribution.sent">
							<span class="fas fa-power-off"></span>
						</a>
					</div>
					<div class="name">
						Send Email
						<span class="label label-danger" ng-hide="distribution.enabled">{{'general.off'|translate}}</span>
					</div>
					<div class="department">
						<span class="title">Department</span>
						{{distribution.department}}
					</div>
				</div>
			</div>
		</div>

		<!-- Follow Up Notes -->
		<div class="details-list vertical notes" ng-show="loaded.followUpNotes">
			<h4>
				<div class="action" ng-if="'notes.create'|hasPermission">
					<a href="" ng-click="newNote()">
						{{'general.add'|translate}}
					</a>
				</div>
				Follow Up Notes
				<a href="" tooltip="Private notes to help track collection attempts on this invoice.">
					<span class="fas fa-info-circle"></span>
				</a>
			</h4>

			<div class="follow-up-notes">
				<!-- New Note -->
				<div class="item" ng-show="newNoteForm">
					<div class="draft-form">
						<div class="message">
							<textarea class="form-control" ng-model="newNote.notes" placeholder="Note here..." expanding-textarea></textarea>
						</div>
						<div class="form-actions">
							<button type="button" class="btn btn-primary Button" ng-click="addNote(invoice, newNote)" ng-disabled="creatingNote||!newNote.notes" v-busy="creatingNote" v-busy-label="{{'general.saving'|translate}}" v-busy-text="{{'general.add'|translate}}" v-pressable>
								<span translate>general.add</span>
							</button>
							<button type="button" class="btn btn-link" ng-click="cancelNote()">{{'general.cancel'|translate}}</button>
						</div>
					</div>
				</div>

				<div class="item" ng-repeat="note in followUpNotes">
					<div ng-hide="note._edit">
						<div class="message" ng-bind-html="note.notes|linky:'_blank'|nl2br"></div>
						<div class="actions">
							<a href="" class="btn btn-link btn-sm" ng-click="editNote(note)" ng-if="'notes.edit'|hasPermission">
								<span class="fas fa-pencil"></span>
							</a>
							<a href="" class="btn btn-link btn-sm" ng-click="deleteNote(note)" ng-if="'notes.delete'|hasPermission">
								<span class="fas fa-trash"></span>
							</a>
						</div>
						<div class="details clearfix">
							<div class="from">{{note.name}}</div>
							<div class="when"><company-date-time date="note.created_at"></company-date-time></div>
						</div>
					</div>
					<div class="draft-form" ng-show="note._edit">
						<div class="message">
							<textarea class="form-control" ng-model="note._draft" placeholder="Note here..." expanding-textarea></textarea>
						</div>
						<div class="form-actions">
							<button type="button" class="btn btn-primary Button" ng-click="saveNoteEdit(note)" ng-disabled="editingNote||!note._draft" v-busy="editingNote" v-busy-label="{{'general.saving'|translate}}" v-busy-text="{{'general.save'|translate}}" v-pressable>
								<span translate>general.save</span>
							</button>
							<button type="button" class="btn btn-link" ng-click="cancelNoteEdit(note)">{{'general.cancel'|translate}}</button>
						</div>
					</div>
				</div>

				<div ng-show="followUpNotes.length == 0 && !newNoteForm">
					<div class="empty">None</div>
				</div>
			</div>
		</div>

		<!-- Accounting Sync Status -->
		<sync-status synced-object="syncedObject" editable="editable" object-type="'invoice'"></sync-status>
	</div>

	<div class="col-sm-8 right-pane">
		<!-- Action Items -->
		<div class="action-items">
			<!-- Needs Attention -->
			<div class="action-item warning" ng-if="hasActionItem('needs_attention')">
				<div class="icon"></div>
				<p>
					This invoice has been flagged as needing attention.
				</p>
				<p ng-if="'invoices.edit'|hasPermission">
					<button type="button" class="btn btn-primary" ng-click="setNeedsAttention(false,invoice)">
						Mark resolved
					</button>
				</p>
			</div>

			<!-- Draft -->
			<div class="action-item suggestion" ng-if="hasActionItem('draft')">
				<div class="icon"></div>
				<p>
					This invoice has not been added to your customer's account yet. Are you ready to issue it?
				</p>
				<p ng-if="'invoices.issue'|hasPermission">
					<button type="button" class="btn btn-success" ng-click="issue(invoice)" ng-disabled="issuing" v-busy="issuing" v-busy-label="Saving" v-pressable>
						Issue invoice
					</button>
				</p>
			</div>

			<!-- Payment Plans -->
			<div class="action-item info" ng-if="hasActionItem('payment_plan_needs_approval')">
				<div class="icon"></div>
				<p>
					This invoice has a payment plan that needs to be approved by the customer before collection can begin.
				</p>
				<p ng-if="hasSendingPermissions" ng-hide="invoice.status == 'sent'">
					<button type="button" class="btn btn-primary" ng-click="sendModal(invoice)">
						Send payment plan
					</button>
				</p>
			</div>
			<div class="action-item info" ng-if="hasActionItem('scheduled_installment_payment')">
				<div class="icon"></div>
				<p>
					The next installment on this invoice is scheduled to be automatically collected from your customer on <company-date date="invoice.next_payment_attempt"></company-date>.
				</p>
				<p ng-if="'charges.create'|hasPermission">
					<button type="button" class="btn btn-primary Button" ng-click="pay(invoice)" ng-disabled="paying" v-busy="paying" v-busy-label="Processing" v-pressable>
						Collect now
					</button>
				</p>
			</div>
			<div class="action-item warning" ng-if="hasActionItem('failed_installment_payment')">
				<div class="icon"></div>
				<p>
					The last
					<span ng-show="invoice.attempt_count==1">
						installment AutoPay attempt
					</span>
					<span ng-show="invoice.attempt_count>1">
						{{invoice.attempt_count}} installment AutoPay attempts
					</span>
					failed.
					We have notified your customer about the failed attempt with the option to update their payment information.
					We will automatically retry again on <company-date date="invoice.next_payment_attempt"></company-date>.
				</p>
				<p ng-if="'charges.create'|hasPermission">
					<button type="button" class="btn btn-primary Button" ng-click="pay(invoice)" ng-disabled="paying" v-busy="paying" v-busy-label="Retrying" v-pressable>
						Retry now
					</button>
				</p>
			</div>

			<!-- AutoPay -->
			<div class="action-item warning" ng-if="hasActionItem('missing_payment_source')">
				<div class="icon"></div>
				<p>
					This customer is missing a payment method. You must add a payment method first in order to collect on this invoice. Your customer can also add a payment method by viewing this invoice online.
				</p>
				<p>
					<button type="button" class="btn btn-primary" ng-click="addPaymentSource(invoice.customer)" ng-if="'customers.edit'|hasPermission">
						Add payment method
					</button>
					<button type="button" class="btn btn-primary" ng-click="sendModal(invoice)" ng-hide="invoice.status == 'sent'" ng-if="hasSendingPermissions">
						Send invoice
					</button>
				</p>
			</div>
			<div class="action-item info" ng-if="hasActionItem('no_scheduled_payment_attempt')">
				<div class="icon"></div>
				<p>
					This invoice has AutoPay enabled but no AutoPay date is scheduled.
				</p>
				<p ng-if="'charges.create'|hasPermission">
					<button type="button" class="btn btn-primary Button" ng-click="pay(invoice)" ng-disabled="paying" v-busy="paying" v-busy-label="Processing" v-pressable>
						Collect now
					</button>
					<button type="button" class="btn btn-default" ng-click="setAutoPayAttempt(invoice)">
						Schedule
					</button>
					<button type="button" class="btn btn-default" ng-click="addPaymentPlan(invoice)">
						Add Payment Plan
					</button>
				</p>
			</div>
			<div class="action-item info" ng-if="hasActionItem('scheduled_payment_attempt')">
				<div class="icon"></div>
				<p>
					This invoice will be automatically collected from your customer. A charge will be attempted automatically on <company-date date="invoice.next_payment_attempt"></company-date>.
				</p>
				<p ng-if="'charges.create'|hasPermission">
					<button type="button" class="btn btn-primary Button" ng-click="pay(invoice)" ng-disabled="paying" v-busy="paying" v-busy-label="Processing" v-pressable>
						Collect now
					</button>
					<button type="button" class="btn btn-default" ng-click="setAutoPayAttempt(invoice)">
						Reschedule payment
					</button>
				</p>
			</div>
			<div class="action-item warning" ng-if="hasActionItem('failed_payment_attempt')">
				<div class="icon"></div>
				<p>
					<span ng-show="invoice.attempt_count==1">
						The last AutoPay attempt failed.
					</span>
					<span ng-show="invoice.attempt_count>1">
						The last {{invoice.attempt_count}} AutoPay attempts failed.
					</span>
					We have notified your customer about the failed attempt with the option to update their payment information.
					We will automatically retry again on <company-date date="invoice.next_payment_attempt"></company-date>.
				</p>
				<p ng-if="'charges.create'|hasPermission">
					<button type="button" class="btn btn-primary Button" ng-click="pay(invoice)" ng-disabled="paying" v-busy="paying" v-busy-label="Retrying" v-pressable>
						Retry now
					</button>
					<button type="button" class="btn btn-default" ng-click="setAutoPayAttempt(invoice)">
						Reschedule payment
					</button>
				</p>
			</div>
			<div class="action-item warning" ng-if="hasActionItem('exhausted_payment_attempts')">
				<div class="icon"></div>
				<p>
					We have exhausted all AutoPay attempts. Your customer needs to submit a payment or you can schedule another AutoPay attempt.
				</p>
				<p ng-if="'charges.create'|hasPermission">
					<button type="button" class="btn btn-primary Button" ng-click="pay(invoice)" ng-disabled="paying" v-busy="paying" v-busy-label="Retrying" v-pressable>
						Retry now
					</button>
					<button type="button" class="btn btn-default" ng-click="setAutoPayAttempt(invoice)" ng-hide="paymentPlan">
						Schedule payment
					</button>
				</p>
			</div>

			<!-- Past Due -->
			<div class="action-item warning" ng-if="hasActionItem('past_due')">
				<div class="icon"></div>
				<p>
					Uh oh. This invoice is past due<span ng-show="invoice.due_date&&!paymentPlan"> since <strong><company-date date="invoice.due_date"></company-date></strong></span>.
				</p>
				<p ng-hide="invoice.next_chase_on">
					<button type="button" class="btn btn-primary" ng-click="sendModal(invoice)" ng-if="hasSendingPermissions">
						Send a late payment reminder
					</button>
				</p>
			</div>

			<!-- Chasing -->
			<div class="action-item info" ng-if="hasActionItem('scheduled_chasing')">
				<div class="icon"></div>
				<p>
					The customer will be followed up with automatically on <company-date date="invoice.next_chase_on"></company-date>.
				</p>
			</div>
			<div class="action-item warning" ng-if="hasActionItem('scheduled_chasing_no_email')">
				<div class="icon"></div>
				<p>
					This invoice has chasing scheduled on <company-date date="invoice.next_chase_on"></company-date> but the customer is missing an email address.
				</p>
				<p ng-if="'customers.edit'|hasPermission">
					<a ui-sref="manage.customer.view.summary({id:invoice.customer.id})" class="btn btn-primary">
						Edit customer
					</a>
				</p>
			</div>
			<div class="action-item suggestion" ng-if="hasActionItem('not_sent')">
				<div class="icon"></div>
				<p>
					Now that you have created your invoice, would you like to send it?
				</p>
				<p>
					<button type="button" class="btn btn-primary" ng-click="sendModal(invoice)" ng-if="hasSendingPermissions">
						Send invoice
					</button>
					<button type="button" class="btn btn-default" ng-click="markSent(true,invoice)" ng-if="'invoices.edit'|hasPermission">
						I already sent it
					</button>
				</p>
			</div>
			<!-- Queued to be sent through network -->
			<div class="action-item info" ng-if="hasActionItem('network_will_send')">
				<div class="icon"></div>
				<p>
					Your invoice will automatically be sent to your customer because they are in your business network. You may also send the invoice to additional contacts by clicking the send button below.
				</p>
				<p>
					<button type="button" class="btn btn-primary" ng-click="sendModal(invoice)" ng-if="hasSendingPermissions">
						Send invoice
					</button>
				</p>
			</div>
			<div class="action-item info" ng-if="hasActionItem('sent')">
				<div class="icon"></div>
				<p>
					Woot! Your invoice has been sent to {{invoice.customer.name}}. We are now waiting for them to receive it and pay.
				</p>
				<p ng-if="hasSendingPermissions">
					<button type="button" class="btn btn-primary" ng-click="sendModal(invoice)">
						Send a friendly reminder
					</button>
				</p>
			</div>

			<!-- Viewed -->
			<div class="action-item info" ng-if="hasActionItem('viewed')">
				<div class="icon"></div>
				<p>
					Great news! <strong>{{invoice.customer.name}}</strong> has viewed your invoice. It's only a matter of time before they pay.
				</p>
			</div>

			<!-- Bad Debt -->
			<div class="action-item warning" ng-if="hasActionItem('bad_debt')">
				<div class="icon"></div>
				<p>
					This invoice was closed before it was paid in full. It is now considered as bad debt. While closed it cannot be edited or collected upon.
				</p>
			</div>

			<!-- Voided -->
			<div class="action-item warning" ng-if="hasActionItem('voided')">
				<div class="icon"></div>
				<p>
					This invoice has been voided.
				</p>
			</div>

			<!-- Payments -->
			<div class="action-item info" ng-if="hasActionItem('pending_payment')">
				<div class="icon"></div>
				<p>
					Payment on this invoice is currently pending. The invoice will be updated once the payment clears.
				</p>
			</div>
			<div class="action-item success" ng-if="hasActionItem('paid')">
				<div class="icon"></div>
				<p>
					Congratulations! Your invoice has been paid in full.
				</p>
			</div>
		</div>

		<!-- Chasing v2 -->
		<div class="panel panel-invoiced light" ng-if="('invoice_chasing'|hasFeature)&&('smart_chasing'|hasFeature)&&loaded.delivery&&loaded.chaseState&&!invoice.paid&&invoice.status!='voided'&&!invoice.closed&&!invoice.date_bad_debt">
			<div class="panel-heading">
				<h4 class="panel-title">
					<div class="action">
						<a href="" ng-click="editCadence(invoice)" ng-if="hasSendingPermissions">
							{{delivery.chase_schedule.length == 0 ? 'Enable' : 'Edit'}}
						</a>
					</div>
					Chasing
				</h4>
			</div>
			<div class="panel-body" ng-if="delivery.chase_schedule.length == 0 && !delivery.disabled">
				<div class="empty">
					Invoice chasing is not set up. <span  ng-if="hasSendingPermissions">Would you like to <a href="" ng-click="editCadence(invoice)">enable invoice chasing</a>?</span>
				</div>
			</div>
			<div class="panel-body" ng-if="delivery.disabled">
				<div class="empty">
					Invoice chasing is disabled. <span  ng-if="hasSendingPermissions">Would you like to <a href="" ng-click="editCadence(invoice)">re-enable invoice chasing</a>?</span>
				</div>
			</div>
			<div ng-if="delivery.chase_schedule.length > 0 && !delivery.disabled">
				<invoice-chase-state state="chaseState" />
			</div>
		</div>

		<!-- Line Items -->
		<div class="panel panel-invoiced light" ng-show="loaded.lineItems">
			<div class="panel-heading">
				<h4 class="panel-title">
					<div class="action" ng-if="('invoices.edit'|hasPermission) && editable" ng-hide="invoice.status == 'voided'">
						<a class="visible-xs" ui-sref="manage.invoice.edit({id:invoice.id})" ng-hide="invoice.closed||(invoice.autopay&&!invoice.draft)">
							Edit Invoice
						</a>
					</div>
					Line Items
				</h4>
			</div>
			<table class="table slim line-items" ng-show="lineItems.length > 0">
				<thead>
					<tr>
						<th class="item">Item</th>
						<th class="quantity">Qty</th>
						<th class="rate">Rate</th>
						<th class="amount">Amount</th>
					</tr>
				</thead>
				<tbody>
					<tr class="line" ng-repeat-start="item in lineItems">
						<td class="item">
							<a href="" ng-click="item.showDetails=!item.showDetails" ng-show="item.hasMetadata">
								<span ng-hide="item.showDetails">[+]</span>
								<span ng-show="item.showDetails">[-]</span>
							</a>

							<item-type item="item"></item-type>
							<span class="item-name" ng-bind-html="item.name|nl2br"></span>
						</td>
						<td class="quantity">
							{{item.quantity|number}}
						</td>
						<td class="rate">
							<money amount="item.unit_cost" currency="invoice.currency" precision="settings.unit_cost_precision"></money>
						</td>
						<td class="amount">
							<span class="item-amount"><money amount="item.amount" currency="invoice.currency"></money></span>
						</td>
					</tr>
					<tr class="line-description" ng-if="item.period_start||item.description||item.discounts.length>0||item.taxes.length>0||!item.taxable||!item.discountable||(item.hasMetadata&&item.showDetails)" ng-repeat-end>
						<td colspan="4">
							<div class="billing-period" ng-show="item.period_start">
								<span ng-show="item.prorated">Proration for</span>
								<company-date date="item.period_start"></company-date>
								&mdash;
								<company-date date="item.period_end"></company-date>
							</div>
							<div class="description" ng-bind-html="item.description|nl2br" ng-show="item.description"></div>
							<div class="rates" ng-bind-html="item|rateList:invoice.currency" ng-show="item.discounts.length>0||item.taxes.length>0"></div>
							<div class="exclusions" ng-hide="item.discountable&&item.taxable">
								<span class="label label-default" ng-hide="item.discountable || invoice.discounts.length == 0">Not discounted</span>
								<span class="label label-default" ng-hide="item.taxable || invoice.taxes.length == 0">Not taxed</span>
							</div>
							<div class="metadata" ng-show="item.hasMetadata && item.showDetails">
								<div class="group" ng-repeat="(key, value) in item.metadata">
									<span class="title"><metadata-name field-id="key" object-type="'line_item'"></metadata-name>:</span>
									<metadata-value field-id="key" object-type="'line_item'" value="value"></metadata-value>
								</div>
							</div>
						</td>
					</tr>
					<tr class="line-item-pagination" ng-show="lineItemPageCount > 1">
						<td colspan="4">
							<div class="controls">
								<div class="btn-group">
									<button type="button" class="btn btn-link btn-sm" ng-click="prevLineItemPage(lineItem)" ng-show="lineItemPage > 1">
										<span class="fas fa-angle-left"></span>
									</button>
									<button type="button" class="btn btn-link btn-sm" ng-click="nextLineItemPage(lineItem)" ng-show="lineItemPage < lineItemPageCount">
										<span class="fas fa-angle-right"></span>
									</button>
								</div>
							</div>
							<div class="total-records">
								Showing {{lineItemRange}} of <strong>{{totalLineItems|number}} line items</strong>.
							</div>
						</td>
					</tr>
				</tbody>
				<tfoot>
					<!-- Subtotal -->
					<tr class="subtotal">
						<td class="noborder"></td>
						<td class="title" colspan="2">
							Subtotal
						</td>
						<td class="amount">
							<money amount="invoice.subtotal" currency="invoice.currency"></money>
						</td>
					</tr>

					<!-- Discounts -->
					<tr class="discounts" ng-show="invoice.discounts.length > 0">
						<td class="noborder"></td>
						<td class="title" colspan="2">
							Discounts
							<discounts-breakdown invoice="invoice"></discounts-breakdown>
						</td>
						<td class="amount">
							<money amount="totals.discounts" currency="invoice.currency"></money>
						</td>
					</tr>

					<!-- Taxes -->
					<tr class="taxes" ng-show="invoice.taxes.length > 0">
						<td class="noborder"></td>
						<td class="title" colspan="2">
							Taxes
							<taxes-breakdown invoice="invoice"></taxes-breakdown>
						</td>
						<td class="amount">
							<money amount="totals.taxes" currency="invoice.currency"></money>
						</td>
					</tr>

					<!-- Shipping (deprecated) -->
					<tr class="shipping" ng-show="invoice.shipping.length > 0">
						<td class="noborder"></td>
						<td class="title" colspan="2">
							Shipping
							<shipping-breakdown invoice="invoice"></shipping-breakdown>
						</td>
						<td class="amount">
							<money amount="totals.shipping" currency="invoice.currency"></money>
						</td>
					</tr>

					<!-- Total -->
					<tr class="total">
						<td class="noborder"></td>
						<td class="title" colspan="2">
							{{'general.total'|translate}}
						</td>
						<td class="amount">
							<money amount="invoice.total" currency="invoice.currency"></money>
						</td>
					</tr>

					<!-- Amount Paid -->
					<tr class="amount-paid" ng-hide="invoice.status == 'voided'">
						<td class="noborder"></td>
						<td class="title" colspan="2">
							Amount Paid
						</td>
						<td class="amount">
							<money amount="invoice.amount_paid" currency="invoice.currency"></money>
						</td>
					</tr>

					<!-- Balance -->
					<tr class="balance" ng-hide="invoice.status == 'voided'">
						<td class="noborder"></td>
						<td class="title" colspan="2">
							{{'general.balance'|translate}}
						</td>
						<td class="amount">
							<money amount="invoice.balance" currency="invoice.currency"></money>
						</td>
					</tr>
				</tfoot>
			</table>
			<div class="panel-body" ng-show="lineItems.length==0">
				<div class="empty">
					No line items found.
				</div>
			</div>
		</div>

		<!-- Notes -->
		<div class="panel panel-invoiced light" ng-show="invoice.notes">
			<div class="panel-heading">
				<h4 class="panel-title">
					Notes
				</h4>
			</div>
			<div class="panel-body" ng-bind-html="invoice.notes|linky:'_blank'|nl2br"></div>
		</div>

		<!-- Payments -->
		<div class="panel panel-invoiced light" ng-show="loaded.payments&&!invoice.draft&&!(invoice.paid&&payments.length==0)">
			<div class="panel-heading">
				<h4 class="panel-title">
					<div class="action">
						<a href="" ng-click="paymentModal(invoice)" ng-hide="invoice.paid||invoice.closed||invoice.status=='pending'||(invoice.autopay&&invoice.status!='past_due')||invoice.status=='voided'" ng-if="['charges.create', 'payments.create']|hasSomePermissions">
							Receive Payment
						</a>
					</div>
					Payment<span ng-show="payments.length>1">s</span>
				</h4>
			</div>
			<div class="panel-body" ng-if="payments.length == 0">
				<div class="empty">
					No payments yet. <span ng-hide="invoice.paid||invoice.closed||(invoice.autopay&&invoice.status!='past_due')||invoice.status=='voided'" ng-if="['charges.create', 'payments.create']|hasSomePermissions">Would you like to <a href="" ng-click="paymentModal(invoice)">receive a payment</a>?</span>
				</div>
			</div>
			<table class="table table-striped search-results-table slim transactions" ng-show="payments.length > 0">
				<thead>
					<tr>
						<th>{{'general.date'|translate}}</th>
						<th>{{'payments.labels.method'|translate}}</th>
						<th class="money-column noborder">{{'general.amount'|translate}}</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<tr class="clickable {{transaction.status}}" ng-repeat="transaction in payments" ng-click="goToObject($event,'transaction_or_payment',transaction)">
						<td class="nowrap light"><company-date date="transaction.date"></company-date></td>
						<td>
							<span ng-show="transaction.credit_note">{{'metadata.object_names.credit_note'|translate}}</span>
							<span ng-hide="transaction.credit_note">{{transaction.method|paymentMethodName}}</span>
						</td>
						<td class="money-column noborder">
							<money amount="-transaction.amount" currency="transaction.currency" ng-show="transaction.type=='refund'||transaction.credit_note"></money>
							<money amount="transaction.amount" currency="transaction.currency" ng-hide="transaction.type=='refund'||transaction.credit_note"></money>
						</td>
						<td class="mobile-last">
							<span class="label label-warning" ng-show="transaction.status=='pending'">{{'general.pending'|translate}}</span>
							<span class="label label-danger" ng-show="transaction.status=='failed'">{{'general.failed'|translate}}</span>
						</td>
					</tr>
				</tbody>
			</table>
		</div>

		<files document="invoice" attachments="attachments" type="invoice"></files>
	</div>
</div>
