<div class="row two-pane">
	<div class="col-sm-4 left-pane">
		<div class="details-list vertical">
			<h4>
				<div class="action" ng-if="'estimates.edit'|hasPermission" ng-hide="estimate.status=='voided'">
					<a class="visible-xs" ui-sref="manage.estimate.edit({id:estimate.id})" ng-hide="estimate.closed">
						{{'estimates.view.summary.edit_estimate'|translate}}
					</a>
				</div>
				{{'estimates.view.summary.details'|translate}}
			</h4>

			<!-- Customer -->
			<div>
				<div class="title">{{'estimates.view.summary.customer'|translate}}</div>
				<div class="value">
					<a href="/customers/{{estimate.customer.id}}">
						{{estimate.customer.name}}
					</a>
				</div>
			</div>

			<!-- Status -->
			<div>
				<div class="title">{{'general.status'|translate}}</div>
				<div class="value">
					<estimate-status estimate="estimate"></estimate-status>
					<span ng-show="estimate.invoice">
						&mdash;
						<a ui-sref="manage.invoice.view.summary({id:estimate.invoice.id})">
							<document-name document="estimate.invoice"></document-name>
						</a>
					</span>
				</div>
			</div>

			<!-- Payment Terms -->
			<div ng-if="estimate.payment_terms">
				<div class="title">Payment Terms</div>
				<div class="value">
					{{estimate.payment_terms}}
				</div>
			</div>

			<!-- Date -->
			<div>
				<div class="title">{{'general.date'|translate}}</div>
				<div class="value">
					<company-date date="estimate.date"></company-date>
				</div>
			</div>

			<!-- Expiry Date -->
			<div ng-show="estimate.expiration_date">
				<div class="title">{{'estimates.view.summary.expires'|translate}}</div>
				<div class="value">
					<company-date date="estimate.expiration_date"></company-date>
				</div>
			</div>

			<!-- Deposit -->
			<div ng-show="estimate.deposit">
				<div class="title">{{'estimates.view.summary.deposit'|translate}}</div>
				<div class="value">
					<money amount="estimate.deposit" currency="estimate.currency"></money>
					<span ng-show="estimate.deposit_paid">
						&mdash;
						<span class="label label-success">{{'estimates.view.summary.paid'|translate}}</span>
					</span>
				</div>
			</div>

			<!-- Purchase Order -->
			<div ng-show="estimate.purchase_order">
				<div class="title">{{'estimates.view.summary.purchase_order'|translate}}</div>
				<div class="value">
					{{estimate.purchase_order}}
				</div>
			</div>

			<!-- Ship To -->
			<div ng-if="estimate.ship_to">
				<div class="title">{{'estimates.view.summary.ship_to'|translate}}</div>
				<div class="value" ng-bind-html="estimate.ship_to|address:true:true:showCountry"></div>
			</div>

			<!-- Approval -->
			<div ng-show="estimate.approval">
				<div class="title">{{'estimates.view.summary.approved'|translate}}</div>
				<div class="value">
					<a href="" ng-click="viewApproval(estimate)">
						<company-date date="estimate.approval.timestamp"></company-date>
						&mdash;
						{{estimate.approval.initials}}
					</a>
				</div>
			</div>

			<!-- Metadata -->
			<div class="=metadata" ng-repeat="(key, value) in estimate.metadata">
				<div class="title"><metadata-name field-id="key" object-type="'estimate'"></metadata-name></div>
				<div class="value">
					<metadata-value field-id="key" object-type="'estimate'" value="value"></metadata-value>
				</div>
			</div>

			<!-- Closed -->
			<div ng-show="estimate.closed">
				<div class="title">{{'estimates.view.summary.closed'|translate}}</div>
				<div class="value">
					<span class="text-danger">{{'estimates.view.summary.yes'|translate}}</span>
					<span ng-if="'estimates.edit'|hasPermission" ng-hide="estimate.status=='voided'">
						&mdash;
						<a href="" ng-click="setClosed(false, estimate)">
							{{'estimates.view.summary.reopen'|translate}}
						</a>
					</span>
				</div>
			</div>
		</div>
	</div>

	<div class="col-sm-8 right-pane">
		<!-- Action Items -->
		<div class="action-items">
			<!-- Draft -->
			<div class="action-item suggestion" ng-if="hasActionItem('draft')">
				<div class="icon"></div>
				<p>
					{{'estimates.view.summary.messages.issue'|translate}}
				</p>
				<p>
					<button type="button" class="btn btn-success" ng-click="issue(estimate)" ng-disabled="issuing" v-busy="issuing" v-busy-label="Saving" v-pressable ng-if="'estimates.issue'|hasPermission">
						{{'estimates.view.summary.issue_estimate'|translate}}
					</button>
					<a class="btn btn-default" ui-sref="manage.estimate.edit({id:estimate.id})" ng-hide="estimate.closed" ng-if="'estimates.edit'|hasPermission">
						{{'estimates.view.summary.edit_estimate'|translate}}
					</a>
				</p>
			</div>
			<!-- Not Sent -->
			<div class="action-item suggestion" ng-if="hasActionItem('not_sent')">
				<div class="icon"></div>
				<p>
					{{'estimates.view.summary.messages.send'|translate}}
				</p>
				<p ng-if="'emails.send'|hasPermission">
					<button type="button" class="btn btn-primary" ng-click="emailModal(estimate)" >
						{{'estimates.view.summary.send'|translate}}
					</button>
					<button type="button" class="btn btn-default" ng-click="markSent(true,estimate)">
						{{'estimates.view.summary.sent'|translate}}
					</button>
				</p>
			</div>
			<!-- Queued to be sent through network -->
			<div class="action-item info" ng-if="hasActionItem('network_will_send')">
				<div class="icon"></div>
				<p>
					Your estimate will automatically be sent to your customer because they are in your business network. You may also send the estimate to additional contacts by clicking the send button below.
				</p>
				<p ng-if="'emails.send'|hasPermission">
					<button type="button" class="btn btn-primary" ng-click="emailModal(estimate)">
						{{'estimates.view.summary.send'|translate}}
					</button>
				</p>
			</div>
			<!-- Sent -->
			<div class="action-item info" ng-if="hasActionItem('sent')">
				<div class="icon"></div>
				<p ng-bind-html="'estimates.view.summary.messages.sent'|translate:{name:estimate.customer.name}"></p>
				<p ng-if="'emails.send'|hasPermission">
					<button type="button" class="btn btn-primary" ng-click="emailModal(estimate)" >
						{{'estimates.view.summary.send_again'|translate}}
					</button>
				</p>
			</div>
			<!-- Viewed -->
			<div class="action-item info" ng-if="hasActionItem('viewed')">
				<div class="icon"></div>
				<p ng-bind-html="'estimates.view.summary.messages.viewed'|translate:{name:estimate.customer.name}"></p>
			</div>
			<!-- Expired -->
			<div class="action-item warning" ng-if="hasActionItem('expired')">
				<div class="icon"></div>
				<p ng-bind-html="'estimates.view.summary.messages.expires'|translate:{date:estimate.expiration_date,date_format:company.date_format}"></p>
				<p ng-if="'estimates.edit'|hasPermission">
					<button type="button" class="btn btn-primary" ng-click="setClosed(true, estimate)">
						{{'estimates.view.summary.close_estimate'|translate}}
					</button>
					<a class="btn btn-default" ui-sref="manage.estimate.edit({id:estimate.id})" ng-hide="estimate.closed">
						{{'estimates.view.summary.edit_estimate'|translate}}
					</a>
				</p>
			</div>
			<!-- Declined -->
			<div class="action-item warning" ng-if="hasActionItem('declined')">	
				<div class="icon"></div>
				<p>
					{{'estimates.view.summary.messages.declined'|translate}}
				</p>
				<p ng-if="'estimates.edit'|hasPermission">
					<button type="button" class="btn btn-primary" ng-click="setClosed(false, estimate)">
						{{'estimates.view.summary.reopen'|translate}}
					</button>
				</p>
			</div>
			<!-- Voided -->
			<div class="action-item warning" ng-if="hasActionItem('voided')">	
				<div class="icon"></div>
				<p>
					{{'estimates.view.summary.messages.voided'|translate}}
				</p>
			</div>
			<!-- Approved + Needs Deposit -->
			<div class="action-item info" ng-if="hasActionItem('needs_deposit')">
				<div class="icon"></div>
				<p ng-bind-html="'estimates.view.summary.messages.approved_deposit'|translate:{approved:estimate.approved}"></p>
				<p ng-if="'estimates.edit'|hasPermission">
					<button type="button" class="btn btn-primary" ng-click="paymentModal(estimate)" ng-hide="saving">
						{{'estimates.view.summary.mark_paid'|translate}}
					</button>
				</p>
			</div>
			<!-- Approved -->
			<div class="action-item success" ng-if="hasActionItem('approved')">
				<div class="icon"></div>
				<p ng-bind-html="'estimates.view.summary.messages.approved'|translate:{approved:estimate.approved}"></p>
				<p ng-if="'invoices.create'|hasPermission">
					<button type="button" class="btn btn-primary" ng-click="makeInvoiceFromEstimate(estimate)" ng-hide="saving">
						{{'estimates.view.summary.convert'|translate}}
					</button>
				</p>
			</div>
			<!-- Invoiced -->
			<div class="action-item success" ng-if="hasActionItem('invoiced')">
				<div class="icon"></div>
				<p ng-bind-html="'estimates.view.summary.messages.approved_invoiced'|translate:{approved:estimate.approved}"></p>
				<p ng-if="'invoices.create'|hasPermission">
					<button type="button" class="btn btn-primary" ng-click="makeInvoiceFromEstimate(estimate)" ng-hide="saving">
						{{'estimates.view.summary.convert'|translate}}
					</button>
				</p>
			</div>
		</div>

		<!-- Line Items -->
		<div class="panel panel-invoiced light" ng-show="loaded.lineItems">
			<div class="panel-heading">
				<h4 class="panel-title">
					<div class="action" ng-if="'estimates.edit'|hasPermission" ng-hide="estimate.status=='voided'">
						<a class="visible-xs" ui-sref="manage.estimate.edit({id:estimate.id})" ng-hide="estimate.closed">
							{{'estimates.view.summary.edit_estimate'|translate}}
						</a>
					</div>
					{{'estimates.view.summary.line_items.title'|translate}}
				</h4>
			</div>
			<table class="table slim line-items" ng-show="lineItems.length > 0">
				<thead>
					<tr>
						<th class="item">{{'estimates.view.summary.line_items.item'|translate}}</th>
						<th class="quantity">{{'estimates.view.summary.line_items.qty'|translate}}</th>
						<th class="rate">{{'estimates.view.summary.line_items.rate'|translate}}</th>
						<th class="amount">{{'general.amount'|translate}}</th>
					</tr>
				</thead>
				<tbody>
					<tr class="line" ng-repeat-start="item in lineItems">
						<td class="item">
							<a href="" ng-click="item.showDetails=!item.showDetails" ng-show="item.hasMetadata">
								<span ng-hide="item.showDetails">[+]</span>
								<span ng-show="item.showDetails">[-]</span>
							</a>

							<item-type item="item"></item-type>
							<span class="item-name" ng-bind-html="item.name|nl2br"></span>
						</td>
						<td class="quantity">
							{{item.quantity|number}}
						</td>
						<td class="rate">
							<money amount="item.unit_cost" currency="estimate.currency" precision="settings.unit_cost_precision"></money>
						</td>
						<td class="amount">
							<span class="item-amount"><money amount="item.amount" currency="estimate.currency"></money></span>
						</td>
					</tr>
					<tr class="line-description" ng-if="item.description||item.discounts.length>0||item.taxes.length>0||!item.taxable||!item.discountable||item.hasMetadata" ng-repeat-end>
						<td colspan="4">
							<div class="billing-period" ng-show="item.period_start">
								<span ng-show="item.prorated">{{'estimates.view.summary.line_items.proration'|translate}}</span>
								<company-date date="item.period_start"></company-date>
								&mdash;
								<company-date date="item.period_end"></company-date>
							</div>
							<div class="description" ng-bind-html="item.description|nl2br" ng-show="item.description"></div>
							<div class="rates" ng-bind-html="item|rateList:estimate.currency" ng-show="item.discounts.length>0||item.taxes.length>0"></div>
							<div class="exclusions" ng-hide="item.discountable&&item.taxable">
								<span class="label label-default" ng-hide="item.discountable || estimate.discounts.length == 0">{{'estimates.view.summary.line_items.not_discounted'|translate}}</span>
								<span class="label label-default" ng-hide="item.taxable || estimate.taxes.length == 0">{{'estimates.view.summary.line_items.not_taxed'|translate}}</span>
							</div>
							<div class="metadata" ng-show="item.hasMetadata && item.showDetails">
								<div class="group" ng-repeat="(key, value) in item.metadata">
									<span class="title"><metadata-name field-id="key" object-type="'line_item'"></metadata-name>:</span>
									<metadata-value field-id="key" object-type="'line_item'" value="value"></metadata-value>
								</div>
							</div>
						</td>
					</tr>
					<tr class="line-item-pagination" ng-show="lineItemPageCount > 1">
						<td colspan="4">
							<div class="controls">
								<div class="btn-group">
									<button type="button" class="btn btn-link btn-sm" ng-click="prevLineItemPage(lineItem)" ng-show="lineItemPage > 1">
										<span class="fas fa-angle-left"></span>
									</button>
									<button type="button" class="btn btn-link btn-sm" ng-click="nextLineItemPage(lineItem)" ng-show="lineItemPage < lineItemPageCount">
										<span class="fas fa-angle-right"></span>
									</button>
								</div>
							</div>
							<div class="total-records" ng-bind-html="'estimates.view.summary.line_items.pagination'|translate:{lineItemRange:lineItemRange,totalLineItems:totalLineItems}"></div>
						</td>
					</tr>
				</tbody>
				<tfoot>
					<!-- Subtotal -->
					<tr class="subtotal">
						<td class="noborder"></td>
						<td class="title" colspan="2">
							{{'estimates.view.summary.line_items.subtotal'|translate}}
						</td>
						<td class="amount">
							<money amount="estimate.subtotal" currency="estimate.currency"></money>
						</td>
					</tr>

					<!-- Discounts -->
					<tr class="discounts" ng-show="estimate.discounts.length > 0">
						<td class="noborder"></td>
						<td class="title" colspan="2">
							{{'estimates.view.summary.line_items.discounts'|translate}}
							<discounts-breakdown invoice="estimate"></discounts-breakdown>
						</td>
						<td class="amount">
							<money amount="totals.discounts" currency="estimate.currency"></money>
						</td>
					</tr>

					<!-- Taxes -->
					<tr class="taxes" ng-show="estimate.taxes.length > 0">
						<td class="noborder"></td>
						<td class="title" colspan="2">
							{{'estimates.view.summary.line_items.taxes'|translate}}
							<taxes-breakdown invoice="estimate"></taxes-breakdown>
						</td>
						<td class="amount">
							<money amount="totals.taxes" currency="estimate.currency"></money>
						</td>
					</tr>

					<!-- Shipping (deprecated) -->
					<tr class="shipping" ng-show="estimate.shipping.length > 0">
						<td class="noborder"></td>
						<td class="title" colspan="2">
							{{'estimates.view.summary.line_items.shipping'|translate}}
							<shipping-breakdown invoice="estimate"></shipping-breakdown>
						</td>
						<td class="amount">
							<money amount="totals.shipping" currency="estimate.currency"></money>
						</td>
					</tr>

					<!-- Total -->
					<tr class="total">
						<td class="noborder"></td>
						<td class="title" colspan="2">
							{{'estimates.view.summary.line_items.total'|translate}}
						</td>
						<td class="amount">
							<money amount="estimate.total" currency="estimate.currency"></money>
						</td>
					</tr>
				</tfoot>
			</table>
			<div class="panel-body" ng-show="lineItems.length==0">
				<div class="empty">
					{{'estimates.view.summary.line_items.empty'|translate}}
				</div>
			</div>
		</div>

		<!-- Notes -->
		<div class="panel panel-invoiced light" ng-show="estimate.notes">
			<div class="panel-heading">
				<h4 class="panel-title">
					{{'estimates.view.summary.notes'|translate}}
				</h4>
			</div>
			<div class="panel-body" ng-bind-html="estimate.notes|linky:'_blank'|nl2br"></div>
		</div>


		<!-- Payments -->
		<div class="panel panel-invoiced light" ng-show="payments.length||(estimate.deposit&&!estimate.deposit_paid)">
			<div class="panel-heading">
				<h4 class="panel-title">
					<div class="action">
						<a href="" ng-click="paymentModal(estimate)" ng-show="estimate.status!='voided'&&!estimate.deposit_paid&&estimate.deposit" ng-if="['charges.create', 'payments.create']|hasSomePermissions">
							Receive Payment
						</a>
					</div>
					Payment<span ng-show="payments.length>1">s</span>
				</h4>
			</div>
			<div class="panel-body" ng-if="payments.length == 0">
				<div class="empty">
					{{'estimates.view.summary.payments.empty'|translate}}
				</div>
			</div>
			<table class="table table-striped search-results-table slim transactions" ng-show="payments.length > 0">
				<thead>
					<tr>
						<th>{{'general.date'|translate}}</th>
						<th>{{'payments.labels.method'|translate}}</th>
						<th class="money-column noborder">{{'general.amount'|translate}}</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<tr class="clickable {{transaction.status}}" ng-repeat="transaction in payments" ng-click="goToObject($event,'transaction_or_payment',transaction)">
						<td class="nowrap light"><company-date date="transaction.date"></company-date></td>
						<td>
							<span ng-show="transaction.credit_note">{{'metadata.object_names.credit_note'|translate}}</span>
							<span ng-hide="transaction.credit_note">{{transaction.method|paymentMethodName}}</span>
						</td>
						<td class="money-column noborder">
							<money amount="-transaction.amount" currency="transaction.currency" ng-show="transaction.type=='refund'||transaction.credit_note"></money>
							<money amount="-transaction.amount" currency="transaction.currency" ng-hide="transaction.type=='refund'||transaction.credit_note"></money>
						</td>
						<td class="mobile-last">
							<span class="label label-warning" ng-show="transaction.status=='pending'">{{'general.pending'|translate}}</span>
							<span class="label label-danger" ng-show="transaction.status=='failed'">{{'general.failed'|translate}}</span>
						</td>
					</tr>
				</tbody>
			</table>
		</div>

		<files document="estimate" attachments="attachments" type="estimate"></files>
	</div>
</div>
