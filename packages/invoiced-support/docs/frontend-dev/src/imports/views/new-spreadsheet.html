<div class="contents">
	<div class="title-bar with-back">
		<div class="settings-title-bar">
			<div class="back-link">
				<a ui-sref="manage.imports.browse">
					<span class="fas fa-chevron-left"></span>
					{{'imports.previous'|translate}}
				</a>
			</div>
		</div>
		<h2 class="title">Spreadsheet Import <small>{{selected.name}}</small></h2>
	</div>

	<div ng-show="step==1">
		<form class="form-horizontal" name="importForm" ng-submit="step2(input, options)">
			<p class="lead">
				Import {{selected.name|lowercase}} into Invoiced from spreadsheets.<br/>
				<small>
					Learn more in our
					<a href="https://docs.invoiced.com/getting-started/importing-data" target="_blank">Importing Docs</a>.
				</small>
			</p>

			<h4>Instructions</h4>
			<ul>
				<li>
					1. Build a spreadsheet with the data you want to import.<br/>
					<a ng-href="{{selected.templateUrl}}" target="_blank">
						Download a sample {{selected.name|lowercase}} import template
					</a>
				</li>
				<li>
					2. Select all of the data in the spreadsheet. Copy it to your clipboard.
				</li>
				<li>
					3. Paste the copied data into the textbox below. Click <strong>Go to Next Step</strong>.
				</li>
				<li>
					4. In the next step we will help you match each column to the corresponding field on Invoiced.
				</li>
			</ul>

			<p class="alert alert-danger" ng-show="error">
				{{error.message}}
			</p>

			<div class="import-data">
				<h4>Paste in {{selected.name|lowercase}} to import</h4>
				<div>
					<textarea class="form-control" ng-model="input" placeholder="Paste your import data in here..." rows="10" required></textarea>
				</div>
			</div>

			<div class="form-group">
				<div class="col-sm-12">
					<label class="noselect">
						<input type="checkbox" ng-model="options.skipFirst" />
						First row has column headers
					</label>
				</div>
			</div>

			<div class="form-group">
				<div class="col-sm-12">
					<label class="control-label">Default Operation</label>
					<div class="invoiced-select input-medium">
						<select ng-model="options.operation" ng-options="option.id as option.name for option in supportedOperations"></select>
					</div>
				</div>
			</div>
			<br/>

			<div class="form-actions">
				<button type="submit" class="btn btn-primary" ng-disabled="importForm.$invalid">
					Go to Next Step
				</button>
			</div>
		</form>
	</div>

	<div ng-show="step==2">
		<form class="form-horizontal" name="importForm2" ng-submit="startImport(columns, records)">
			<p>
				The final step is to match each column with the corresponding field in Invoiced. We've included the first few rows to help you match the columns. When you are finished matching you can start the import.
			</p>

			<p>
				<button type="button" class="btn btn-default" ng-click="step1(input)">
					<span class="fas fa-arrow-left"></span>
					Edit Data
				</button>
			</p>			

			<p class="alert alert-danger" ng-show="error">
				{{error.message}}
			</p>

			<div class="import-columns-holder">
				<table class="table table-striped">
					<thead>
						<tr>
							<th>Column</th>
							<th ng-if="records.length>=1">1st Row</th>
							<th ng-if="records.length>=2">2nd Row</th>
							<th ng-if="records.length>=3">3rd Row</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="col in columns" ng-class="{missing: !col.id}">
							<td class="column-field">
								<div class="invoiced-select">
									<select ng-options="property.id as property.name for property in selected.properties" ng-model="col.id" ng-change="matchedCol()"></select>
								</div>
							</td>
							<td class="value" ng-if="records.length>=1">
								{{records[0][$index]}}
							</td>
							<td class="value" ng-if="records.length>=2">
								{{records[1][$index]}}
							</td>
							<td class="value" ng-if="records.length>=3">
								{{records[2][$index]}}
							</td>
						</tr>
					</tbody>
					<tfoot>
						<tr>
							<th></th>
							<th class="more" ng-if="records.length==1"></th>
							<th colspan="2" class="more" ng-if="records.length==2"></th>
							<th colspan="3" class="more" ng-if="records.length==3"></th>
							<th colspan="3" class="more" ng-if="records.length>3">Only showing the first 3 lines...</th>
						</tr>
					</tfoot>
				</table>
			</div>

			<div class="form-actions">
				<button type="submit" class="btn btn-primary Button" ng-disabled="notAllColumnsMatched||importing" v-busy="importing" v-busy-label="{{'general.starting'|translate}}" v-busy-text="{{'general.start'|translate}}" v-pressable>
					<span translate>general.start</span>
				</button>
			</div>
		</form>
	</div>
</div>