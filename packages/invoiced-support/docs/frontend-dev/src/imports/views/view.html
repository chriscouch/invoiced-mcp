<p class="loading" ng-show="loading && !loadedAtLeastOnce"></p>

<div class="object-view import" ng-hide="loading && !loadedAtLeastOnce">
	<div class="title-bar with-back">
		<div class="back">
			<a ui-sref="manage.imports.browse">
				<span class="fas fa-chevron-left"></span>
				{{'imports.previous'|translate}}
			</a>
		</div>

		<!-- Title -->
		<h2>Import</h2>
		<h3>{{modelTitle}}</h3>
	</div>

	<ul class="nav nav-tabs">
		<!-- Tab Links -->
		<li class="active">
			<a href="">
				{{'tabs.summary'|translate}}
			</a>
		</li>
	</ul>

	<!-- Selected Tab Content -->
	<div class="tab-content">
		<div class="tab-pane active">
			<div class="row two-pane">
				<div class="col-sm-4 left-pane">
					<div class="details-list vertical">
						<h4>
							Import Details
						</h4>

						<!-- Type -->
						<div>
							<div class="title">Type</div>
							<div class="value">{{type}}</div>
						</div>

						<!-- Date -->
						<div>
							<div class="title">Started</div>
							<div class="value">
								<company-date-time date="import.created_at"></company-date-time>
								<span ng-show="duration">&mdash; <span ng-show="import.status=='pending'">running</span><span ng-hide="import.status=='pending'">ran</span> for {{duration}}</span>
							</div>
						</div>

						<!-- User -->
						<div ng-show="import.user">
							<div class="title">Imported By</div>
							<div class="value">
								{{import.user.first_name}}
								{{import.user.last_name}}
							</div>
						</div>

						<!-- # Created / Updated / Failed -->
						<div ng-show="import.total_records > 0">
							<div class="title">Total Records</div>
							<div class="value">{{import.total_records|number}}</div>
						</div>

						<div ng-show="import.status!='pending'||import.num_imported>0">
							<div class="title"># Created</div>
							<div class="value">{{import.num_imported|number}}</div>
						</div>

						<div ng-show="import.num_updated">
							<div class="title"># Updated</div>
							<div class="value">{{import.num_updated|number}}</div>
						</div>

						<div ng-show="import.num_failed">
							<div class="title"># Failed</div>
							<div class="value">{{import.num_failed|number}}</div>
						</div>

						<!-- Status -->
						<div>
							<div class="title">{{'general.status'|translate}}</div>
							<div class="value">
								<span class="label" ng-class="{'label-danger':import.status=='failed','label-warning':import.status=='pending','label-success':import.status=='succeeded'}">{{import.status}}</span>
								<div class="loading inline" ng-show="import.status=='pending'"></div>
							</div>
						</div>
					</div>
				</div>

				<div class="col-sm-8 right-pane">
					<!-- Action Items -->
					<div class="action-items">
						<div class="action-item info" ng-if="import.status=='pending'">
							<div class="icon"></div>
							<p>
								Your import has begun. Feel free to go elsewhere while you wait. We will send you an email once it is finished.
							</p>
							<div class="progress-holder">
								<div class="progress">
									<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{progress}}" aria-valuemin="0" aria-valuemax="100" style="width: {{progress}}%;">
										<span class="sr-only">{{progress}}% Complete</span>
									</div>
								</div>
								<div class="status" ng-show="progress==100">
									Finalizing...
								</div>
								<div class="status" ng-show="import.total_records && progress < 100">
									<strong>{{progress|number:0}}% complete</strong>
									&mdash;
									{{import.position|number}} / {{import.total_records|number}} {{pluralType}}
								</div>
								<div class="status" ng-hide="import.total_records">
									Starting...
								</div>
								<div class="detail-text" ng-show="import.message">
									Current Task:
									<em>{{import.message}}</em>
								</div>
							</div>
						</div>
						<div class="action-item success" ng-if="import.status=='succeeded'">
							<div class="icon"></div>
							<p>
								Your import has finished.
							</p>
						</div>
						<div class="action-item warning" ng-if="import.status=='failed'">
							<div class="icon"></div>
							<p>
								Your import did not finish successfully. <span ng-show="import.failure_detail">Please see the details below.</span>
							</p>
						</div>
					</div>

					<!-- Failures -->
					<div class="panel panel-invoiced light" ng-show="import.failure_detail.length > 0">
						<div class="panel-heading">
							<h4 class="panel-title">
								Failure Details
							</h4>
						</div>
						<table class="table table-striped search-results-table slim import-failures">
							<thead>
								<tr>
									<th class="line-no" ng-if="import.failure_detail.length > 1">#</th>
									<th>Reason</th>
									<th></th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="row in import.failure_detail">
									<td class="line-no" ng-if="import.failure_detail.length > 1">
										{{$index + 1}}.
									</td>
									<td>
										<div class="failure-reason">
											{{row.reason}}
										</div>
										<div class="record-detail" ng-show="show[$index]" ng-if="row.data">
											<div ng-show="row.line_number">
												Line #:
												{{row.line_number}}
											</div>
											<import-record-value value="row.data"></import-record-value>
										</div>
									</td>
									<td class="show-record" ng-class="{off:!row.data}">
										<a href="" ng-click="show[$index]=!show[$index]">
											<span ng-show="show[$index]">[-] Hide record</span>
											<span ng-hide="show[$index]">[+] Show record</span>
										</a>
									</td>
								</tr>
							</tbody>
						</table>
					</div>

					<!-- Imported Objects -->
					<div class="panel panel-invoiced light" ng-show="importedObjects.length>0">
						<div class="panel-heading">
							<h4 class="panel-title">
								Created Objects
								<span class="badge">{{import.num_imported|number}}</span>
							</h4>
						</div>
						<table class="search-results-table table table-striped slim">
							<thead>
								<tr>
									<th>Description</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="obj in importedObjects">
									<td class="title">
										<a href="" ng-click="link(obj)">
											{{obj.name}}
										</a>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>