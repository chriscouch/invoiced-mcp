<p class="loading" ng-show="loading"></p>
<div class="object-view import" ng-hide="loading">
    <div class="title-bar">
        <div class="row">
            <div class="col-sm-10">
                <h2>{{paymentBatch.name}}</h2>
                <h3>{{paymentBatch.number}}</h3>
            </div>
        </div>
    </div>

    <ul class="nav nav-tabs">
        <!-- Tab Links -->
        <li ui-sref-active="active">
            <a ui-sref="manage.vendor_payment_batches.summary">
                {{'tabs.summary'|translate}}
            </a>
        </li>

        <!-- Action Buttons -->
        <li class="action right" dropdown>
            <a href="" class="dropdown-toggle" dropdown-toggle>
                <span class="actions-label"></span>
                <span class="fas fa-chevron-down"></span>
            </a>
            <ul class="dropdown-menu dropdown-menu-right">
                <li ng-if="payable">
                    <a href="" ng-click="pay(paymentBatch)">
                        Submit for Payment
                    </a>
                </li>
                <li ng-if="printable">
                    <a href="" ng-click="print(paymentBatch)" ng-hide="printing">
                        Print
                    </a>
                </li>
                <li ng-if="hasPaymentFile">
                    <a href="" ng-click="paymentFile(paymentBatch)" ng-hide="generating">
                        Download Payment File
                    </a>
                </li>
                <li class="divider" ng-show="voidable"></li>
                <li class="danger" ng-if="'vendor_payments.delete'|hasPermission" ng-show="voidable">
                    <a href="" ng-click="delete(paymentBatch)" ng-hide="deleting">
                        Void Batch
                    </a>
                </li>
            </ul>
        </li>
    </ul>

    <div class="tab-content">
        <div class="row two-pane">
            <div class="col-sm-4 left-pane">
                <div class="details-list vertical">
                    <h4>
                        {{'vendor_payment_batches.view.details'|translate}}
                    </h4>

                    <!-- Date -->
                    <div>
                        <div class="title">{{'general.date'|translate}}</div>
                        <div class="value">
                            <company-date date="paymentBatch.date"></company-date>
                        </div>
                    </div>

                    <!-- Total -->
                    <div>
                        <div class="title">{{'general.total'|translate}}</div>
                        <div class="value">
                            <money currency="paymentBatch.currency" amount="paymentBatch.total"></money>
                        </div>
                    </div>

                    <!-- Bank Account -->
                    <div ng-show="paymentBatch.bank_account">
                        <div class="title">{{'general.bank_account'|translate}}</div>
                        <div class="value">
                            {{paymentBatch.bank_account.name}}
                        </div>
                    </div>

                    <!-- Card -->
                    <div ng-show="paymentBatch.card">
                        <div class="title">Card</div>
                        <div class="value">
                            <card-icon brand="paymentBatch.card.brand"></card-icon>
                            {{paymentBatch.card.name}}
                        </div>
                    </div>

                    <!-- Payment Method -->
                    <div>
                        <div class="title">{{'general.payment_method'|translate}}</div>
                        <div class="value">
                            {{('payment_method.'+paymentBatch.payment_method)|translate}}
                        </div>
                    </div>

                    <!-- Initial Check # -->
                    <div ng-show="paymentBatch.initial_check_number">
                        <div class="title">{{'vendor_payment_batches.view.initial_check_number'|translate}}</div>
                        <div class="value">
                            {{paymentBatch.initial_check_number}}
                        </div>
                    </div>

                    <!-- Check Layout -->
                    <div ng-show="paymentBatch.check_layout">
                        <div class="title">{{'vendor_payment_batches.view.layout'|translate}}</div>
                        <div class="value">
                            <span ng-if="paymentBatch.check_layout=='CheckOnTop'">{{'vendor_payment_batches.view.layout_one'|translate}}</span>
                            <span ng-if="paymentBatch.check_layout=='ThreePerPage'">{{'vendor_payment_batches.view.layout_three'|translate}}</span>
                        </div>
                    </div>

                    <!-- Status -->
                    <div>
                        <div class="title">{{'general.status'|translate}}</div>
                        <div class="value">
                            <vendor-payment-batch-status payment-batch="paymentBatch"></vendor-payment-batch-status>
                        </div>
                    </div>

                    <!-- User -->
                    <div>
                        <div class="title">{{'vendor_payment_batches.view.member'|translate}}</div>
                        <div class="value">{{paymentBatch.member.user.first_name}} {{paymentBatch.member.user.last_name}}</div>
                    </div>
                </div>
            </div>

            <div class="col-sm-8 right-pane">
                <!-- Action Items -->
                <div class="action-items">
                    <!-- Submit for Payment -->
                    <div class="action-item info" ng-if="payable">
                        <div class="icon"></div>
                        <p>
                            This payment batch is ready to be submitted for payment.
                        </p>
                        <p>
                            <a href="" class="btn btn-primary" ng-click="pay(paymentBatch)">Submit for Payment</a>
                        </p>
                    </div>

                    <!-- Print Check -->
                    <div class="action-item success" ng-if="printable">
                        <div class="icon"></div>
                        <p>
                            This payment batch has been completed. You can now print your checks.
                        </p>
                        <p>
                            <a href="" class="btn btn-primary" ng-click="print(paymentBatch)" ng-hide="printing">Print Checks</a>
                        </p>
                    </div>

                    <!-- Payment File -->
                    <div class="action-item success" ng-if="hasPaymentFile">
                        <div class="icon"></div>
                        <p>
                            This payment batch has been completed. You can now download the payment file and send it to your bank.
                        </p>
                        <p>
                            <a href="" class="btn btn-primary" ng-click="paymentFile(paymentBatch)" ng-hide="generating">Download Payment File</a>
                        </p>
                    </div>

                    <!-- Failures -->
                    <div class="action-item warning" ng-if="failures.length > 0">
                        <div class="icon"></div>
                        <p>
                            This payment batch has at least one failed item. Please review the error and submit a new payment.
                        </p>
                    </div>
                </div>

                <!-- Payments -->
                <div class="panel panel-invoiced light" ng-show="payments.length > 0">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <div class="action">
                                <a href="/vendor_payments?vendor_payment_batch={{paymentBatch.id}}">
                                    {{'general.view_all'|translate}}
                                </a>
                            </div>
                            {{'vendor_payment_batches.view.payments'|translate}}
                        </h4>
                    </div>
                    <table class="table search-results-table">
                        <thead>
                            <tr>
                                <th>{{'vendor_payment_batches.view.vendor'|translate}}</th>
                                <th>{{'general.date'|translate}}</th>
                                <th>{{'vendor_payment_batches.view.payment_method'|translate}}</th>
                                <th>{{'general.reference'|translate}}</th>
                                <th class="money-column">{{'general.amount'|translate}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="clickable" ng-repeat="payment in payments" ng-click="goToObject($event,'vendor_payment',payment.id)">
                                <td class="title mobile-first">{{payment.vendor.name}}</td>
                                <td>{{payment.date|formatCompanyDate}}</td>
                                <td>{{payment.payment_method|paymentMethodName}}</td>
                                <td>{{payment.reference}}</td>
                                <td class="money-column mobile-last">
                                    <money currency="payment.currency" amount="payment.amount"></money>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="invoice-pagination">
                                <td colspan="5">
                                    <div class="controls" ng-show="paymentPageCount > 1">
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-link btn-sm" ng-click="prevPaymentPage(paymentBatch)" ng-show="paymentPage > 1">
                                                <span class="fas fa-angle-left"></span>
                                            </button>
                                            <button type="button" class="btn btn-link btn-sm" ng-click="nextPaymentPage(paymentBatch)" ng-show="paymentPage < paymentPageCount">
                                                <span class="fas fa-angle-right"></span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="total-records">
                                        Showing {{paymentRange}} of <strong>{{totalPayments|number}} payments</strong>.
                                    </div>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <!-- Failures -->
                <div class="panel panel-invoiced light" ng-show="failures.length > 0">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            {{'vendor_payment_batches.view.failures'|translate}}
                            <span class="badge">{{failures.length}}</span>
                        </h4>
                    </div>
                    <table class="table search-results-table">
                        <thead>
                            <tr>
                                <th>{{'vendor_payment_batches.view.vendor'|translate}}</th>
                                <th>{{'vendor_payment_batches.view.bill'|translate}}</th>
                                <th>{{'vendor_payment_batches.view.error'|translate}}</th>
                                <th class="money-column">{{'general.amount'|translate}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="item in failures">
                                <td class="mobile-first">
                                    <a ui-sref="manage.vendor.view.summary({id:item.vendor_id})">
                                        {{item.vendor.name}}
                                    </a>
                                </td>
                                <td>
                                    <a ui-sref="manage.bill.view.summary({id:item.bill_id})">
                                        {{item.bill_number}}
                                    </a>
                                </td>
                                <td>
                                    {{item.error}}
                                </td>
                                <td class="total money-column mobile-last">
                                    <money currency="paymentBatch.currency" amount="item.amount"></money>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Items -->
                <div class="panel panel-invoiced light" ng-show="paymentBatch.status != 'Finished' && paymentBatch.status != 'Voided'">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            {{'vendor_payment_batches.view.bills'|translate}}
                        </h4>
                    </div>
                    <table class="table search-results-table">
                        <thead>
                            <tr>
                                <th>{{'vendor_payment_batches.view.vendor'|translate}}</th>
                                <th>{{'vendor_payment_batches.view.bill'|translate}}</th>
                                <th class="money-column">{{'general.amount'|translate}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="item in items">
                                <td class="mobile-first">
                                    <a ui-sref="manage.vendor.view.summary({id:item.vendor_id})">
                                        {{item.vendor.name}}
                                    </a>
                                </td>
                                <td>
                                    <a ui-sref="manage.bill.view.summary({id:item.bill_id})">
                                        {{item.bill_number}}
                                    </a>
                                </td>
                                <td class="total money-column mobile-last">
                                    <money currency="paymentBatch.currency" amount="item.amount"></money>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
</div>