{% if invoice.balance == 0 %}
    <div class="paid-stamp">
        {{ trans('labels.paid')|upper }}
    </div>
{% endif %}

<div class="container">
    <div class="title-bar">
        <div class="logo">
            {% if company.logo %}
                <img src="{{ company.logo }}" />
            {% endif %}
        </div>
        <div class="title">{% if theme.use_translations %}{{ trans('headers.invoice') }}{% else %}{{ theme.header }}{% endif %}</div>
        <div class="invoice-number"># {{ invoice.number }}</div>
    </div>

    <div class="spacer highlight-color-border"></div>

    <div class="context-holder">
        <div class="contact-from">
            <div class="field">{% if theme.use_translations %}{{ trans('labels.bill_from') }}{% else %}{{ theme.from_title }}{% endif %}</div>
            <div class="name">{{ company.name }}</div>
            <div class="address">{{ company.address|nl2br }}</div>
            {% if company.email %}<div class="email">{{ company.email }}</div>{% endif %}
            {% if company.phone %}<div class="phone">{{ company.phone }}</div>{% endif %}
            {% if company.website %}<div class="website">{{ company.website }}</div>{% endif %}
        </div>

        <div class="contact-to bill">
            <div class="field">{% if theme.use_translations %}{{ trans('labels.bill_to') }}{% else %}{{ theme.to_title }}{% endif %}</div>
            <div class="value">
                {% if customer.attention_to %}<div class="attention_to">{{ trans('labels.attention_to') }}: {{ customer.attention_to }}</div>{% endif %}
                <div class="name">{{ customer.name }}</div>
                <div class="address">{{ customer.address|nl2br }}</div>
            </div>
        </div>

        {% if invoice.ship_to %}
            <div class="contact-to ship">
                <div class="value">
                    <span class="field">{% if theme.use_translations %}{{ trans('labels.ship_to') }}{% else %}{{ theme.ship_to_title }}{% endif %}</span><br>
                    {% if invoice.ship_to.attention_to %}<div class="attention_to">{{ trans('labels.attention_to') }}: {{ invoice.ship_to.attention_to }}</div>{% endif %}
                    <div class="name">{{ invoice.ship_to.name }}</div>
                    <div class="address">{{ invoice.ship_to.address|nl2br }}</div>
                </div>
            </div>
        {% endif %}

        <div class="context">
            <table class="context-table" cellspacing=0>
                {% if theme.show_customer_no %}
                    <tr class="field-holder">
                        <td class="field">{% if theme.use_translations %}{{ trans('labels.account_number') }}{% else %}{{ theme.customer_number_title }}{% endif %}</td>
                        <td class="value">{{ customer.number }}</td>
                    </tr>
                {% endif %}
                {% if invoice.date %}
                    <tr class="field-holder">
                        <td class="field">{% if theme.use_translations %}{{ trans('labels.date') }}{% else %}{{ theme.date_title }}{% endif %}</td>
                        <td class="value">{{ invoice.date }}</td>
                    </tr>
                {% endif %}
                {% if invoice.payment_terms %}
                    <tr class="field-holder">
                        <td class="field">{% if theme.use_translations %}{{ trans('labels.payment_terms') }}{% else %}{{ theme.payment_terms_title }}{% endif %}</td>
                        <td class="value">{{ invoice.payment_terms }}</td>
                    </tr>
                {% endif %}
                {% if invoice.due_date %}
                    <tr class="field-holder">
                        <td class="field">{% if theme.use_translations %}{{ trans('labels.due_date') }}{% else %}{{ theme.due_date_title }}{% endif %}</td>
                        <td class="value">{{ invoice.due_date }}</td>
                    </tr>
                {% endif %}
                {% if invoice.purchase_order %}
                    <tr class="field-holder">
                        <td class="field">{% if theme.use_translations %}{{ trans('labels.purchase_order') }}{% else %}{{ theme.purchase_order_title }}{% endif %}</td>
                        <td class="value">{{ invoice.purchase_order }}</td>
                    </tr>
                {% endif %}
                {% for field in invoice.custom_fields %}
                    <tr class="field-holder">
                        <td class="field">{{ field.name }}</td>
                        <td class="value">{{ field.value|raw }}</td>
                    </tr>
                {% endfor %}
                <tr class="field-holder bolder">
                    <td class="field">{% if theme.use_translations %}{{ trans('labels.balance_due') }}{% else %}{{ theme.balance_title }}{% endif %}</td>
                    <td class="value">{{ invoice.balance|money }}</td>
                </tr>
            </table>
        </div>
    </div>

    <div class="spacer highlight-color-border"></div>

    <div class="items-holder">
        <table class="items" cellpadding=0 cellspacing=0>
            <thead>
                <tr>
                    <th class="highlight-color-border">
                        <div>{% if theme.use_translations %}{{ trans('columns.item') }}{% else %}{{ theme.item_header }}{% endif %}</div>
                    </th>
                    <th class="highlight-color-border narrow">
                        <div>{% if theme.use_translations %}{{ trans('columns.quantity') }}{% else %}{{ theme.quantity_header }}{% endif %}</div>
                    </th>
                    <th class="highlight-color-border money-column narrow">
                        <div>{% if theme.use_translations %}{{ trans('columns.unit_cost') }}{% else %}{{ theme.unit_cost_header }}{% endif %}</div>
                    </th>
                    <th class="highlight-color-border money-column narrow">
                        <div>{% if theme.use_translations %}{{ trans('columns.amount') }}{% else %}{{ theme.amount_header }}{% endif %}</div>
                    </th>
                </tr>
            </thead>
            <tbody>
            {% for item in invoice.items %}
                <tr class="item">
                    <td class="name">
                        <div class="main">
                            {{ item.name|nl2br }}
                            {% if item.description or item.billing_period %}
                                <span class="details">
                                            {% if item.description %}
                                                {{ item.description|nl2br }}
                                                {% if item.billing_period %}
                                                    <raw> – </raw>
                                                {% endif %}
                                            {% endif %}
                                    {% if item.billing_period %}
                                        {{ item.billing_period }}
                                    {% endif %}
                                        </span>
                            {% endif %}
                            {% if item.rates %}
                                <span class="details">
                                        <span class="rates"> – {{ item.rates }}</span>
                                    </span>
                            {% endif %}
                        </div>
                        {% for name, value in item.custom_fields %}
                            <div class="details custom-field">{{ name }}: {{ value }}</div>
                        {% endfor %}
                    </td>
                    <td class="quantity">{{ item.quantity|number_format_no_round }}</td>
                    <td class="unit_cost">{{ item.unit_cost|money_unit_cost }}</td>
                    <td class="amount">{{ item.amount|money }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="totals-holder">
        <table class="totals" cellpadding=0 cellspacing=0>
            {% if invoice.rates|length > 0 %}
                <tr class="field-holder">
                    <td class="field">{% if theme.use_translations %}{{ trans('labels.subtotal') }}{% else %}{{ theme.subtotal_title }}{% endif %}</td>
                    <td class="value">{{ invoice.subtotal|money }}</td>
                </tr>
                {% for rate in invoice.rates %}
                    <tr class="field-holder">
                        <td class="field">{{ rate.name }}</td>
                        <td class="value">{{ rate.total|money }}</td>
                    </tr>
                    {% if rate.expires %}
                        <tr class="field-holder">
                            <td colspan="2" class="value">{{ trans('labels.expires_on', {'%date%': rate.expires}) }}</td>
                        </tr>
                    {% endif %}
                {% endfor %}
                <tr class="field-holder border-top">
                    <td class="field">{% if theme.use_translations %}{{ trans('labels.total') }}{% else %}{{ theme.total_title }}{% endif %}</td>
                    <td class="value">{{ invoice.total|money }}</td>
                </tr>
            {% else %}
                <tr class="field-holder">
                    <td class="field">{% if theme.use_translations %}{{ trans('labels.total') }}{% else %}{{ theme.total_title }}{% endif %}</td>
                    <td class="value">{{ invoice.total|money }}</td>
                </tr>
            {% endif %}
            {% if invoice.amount_paid %}
                {% for item in invoice.payments %}
                    <tr class="field-holder">
                        <td class="field">{{ item.name }}</td>
                        <td class="value">{{ item.amount|money }}</td>
                    </tr>
                {% endfor %}
                <tr class="field-holder border-top-2 bolder">
                    <td class="field">{% if theme.use_translations %}{{ trans('labels.balance_due') }}{% else %}{{ theme.balance_title }}{% endif %}</td>
                    <td class="value">{{ invoice.balance|money }}</td>
                </tr>
            {% endif %}
        </table>
    </div>

    {% if invoice.notes or invoice.terms %}
        <div class="footer">
            {% if invoice.notes %}
                <div class="notes-holder">
                    <div class="field">{% if theme.use_translations %}{{ trans('labels.notes') }}{% else %}{{ theme.notes_title }}{% endif %}</div>
                    <div class="notes">{{ invoice.notes|nl2br }}</div>
                </div>
            {% endif %}
            {% if invoice.terms %}
                <div class="terms-holder">
                    <div class="field">{% if theme.use_translations %}{{ trans('labels.terms') }}{% else %}{{ theme.terms_title }}{% endif %}</div>
                    <div class="terms">{{ invoice.terms|nl2br }}</div>
                </div>
            {% endif %}
        </div>
    {% endif %}
</div>

{% if paymentPlan %}
    <div class="installment-holder">
        <div class="logo">
            {% if company.logo %}<img src="{{ company.logo }}" />{% endif %}
        </div>
        {% if invoice.ship_to %}
            <div class="two-col clearfix">
                <div class="col">
                    <div class="contact to">
                        <div class="field">{% if theme.use_translations %}{{ trans('labels.bill_to') }}{% else %}{{ theme.to_title }}{% endif %}</div>
                        <div class="value">
                            {% if customer.attention_to %}<div class="attention_to">{{ trans('labels.attention_to') }}: {{ customer.attention_to }}</div>{% endif %}
                            <div class="name">{{ customer.name }}</div>
                            <div class="address">{{ customer.address|nl2br }}</div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="contact to">
                        <div class="field">{% if theme.use_translations %}{{ trans('labels.ship_to') }}{% else %}{{ theme.ship_to_title }}{% endif %}</div>
                        <div class="value">
                            {% if invoice.ship_to.attention_to %}<div class="attention_to">{{ trans('labels.attention_to') }}: {{ invoice.ship_to.attention_to }}</div>{% endif %}
                            <div class="name">{{ invoice.ship_to.name }}</div>
                            <div class="address">{{ invoice.ship_to.address|nl2br }}</div>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="contact to">
                <div class="field">{% if theme.use_translations %}{{ trans('labels.bill_to') }}{% else %}{{ theme.to_title }}{% endif %}</div>
                <div class="value">
                    {% if customer.attention_to %}<div class="attention_to">{{ trans('labels.attention_to') }}: {{ customer.attention_to }}</div>{% endif %}
                    <div class="name">{{ customer.name }}</div>
                    <div class="address">{{ customer.address|nl2br }}</div>
                </div>
            </div>
        {% endif %}
        <div class="table-summary">
            Installment Balances as of {{ "now"|date('M j, Y') }}
        </div>
        <table class="installment-table" cellpadding=3 cellspacing=0>
            <thead>
            <tr>
                <th class="fixed-width">{{ trans('columns.due_date') }}</th>
                <th class="fixed-width">{{ trans('columns.amount') }}</th>
                <th class="fixed-width">{{ trans('columns.balance') }}</th>
            </tr>
            </thead>
            <tbody>
            {% for line in paymentPlan.installments %}
                <tr>
                    <td>{{ line.date }}</td>
                    <td>{{ line.amount|money }}</td>
                    <td>{{ line.balance|money }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endif %}

<div class="hidden"></div>
