{% trans_default_domain 'general' %}
{% set title='Company Information' %}
{% extends "onboarding/parent.twig" %}

{% block main %}

    <div class="container-lg container-fluid">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10 col-xl-8">
                <form class="py-6" method="post" id="theForm">
                    <input type="hidden" name="_csrf_token" value="{{ csrf_token('onboarding') }}" />
                    <div class="row justify-content-center">
                        <div class="col-12 col-md-10 col-lg-8 col-xl-6 text-center">
                            <h6 class="mb-4 text-uppercase text-muted">
                                Step {{ currentStepNumber }} of {{ totalSteps }}
                            </h6>

                            <h1 class="mb-3">
                                Business Details
                            </h1>

                            <p class="mb-5 text-muted">
                                This should be the information you use to conduct business.
                            </p>
                        </div>
                    </div>

                    {% for error in errors %}
                        <div class="text-danger mb-3" role="alert">{{ error }}</div>
                    {% endfor %}

                    {% set companyName = app.request.request.get('company_name')|default(company.name) %}
                    {% if company.type == 'company' %}
                        <div class="form-group">
                            <label class="form-label">
                                Company Name
                            </label>

                            <small class="form-text text-muted">
                                Enter the legal name of your company.
                            </small>

                            <input type="text" required="required" class="form-control" name="company_name" value="{{ companyName }}" />
                        </div>

                        <div class="form-group">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="dbaCheck" name="has_dba" value="1" {% if company.nickname %}checked="checked"{% endif %}>
                                <label class="form-check-label" for="dbaCheck">
                                    My business is doing business under a different name
                                </label>
                            </div>
                        </div>
                    {% elseif company.type == 'person' %}
                        {% if not companyName %}
                            {% set companyName = user.name(true) %}
                        {% endif %}
                        <div class="form-group">
                            <label class="form-label">
                                Owner Name
                            </label>

                            <small class="form-text text-muted">
                                Enter the legal name of the person that owns this business.
                            </small>

                            <input type="text" required="required" class="form-control" name="company_name" value="{{ companyName }}" />
                        </div>

                        <div class="form-group">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="dbaCheck" name="has_dba" value="1" {% if company.nickname %}checked="checked"{% endif %}>
                                <label class="form-check-label" for="dbaCheck">
                                    My business is doing business under a different name
                                </label>
                            </div>
                        </div>
                    {% elseif company.type == 'non_profit' %}
                        <div class="form-group">
                            <label class="form-label">
                                Nonprofit Name
                            </label>

                            <small class="form-text text-muted">
                                Enter the legal name of your nonprofit.
                            </small>

                            <input type="text" required="required" class="form-control" name="company_name" value="{{ companyName }}" />
                        </div>

                        <div class="form-group">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="dbaCheck" name="has_dba" value="1" {% if company.nickname %}checked="checked"{% endif %}>
                                <label class="form-check-label" for="dbaCheck">
                                    My nonprofit is doing business under a different name
                                </label>
                            </div>
                        </div>
                    {% elseif company.type == 'government' %}
                        <div class="form-group">
                            <label class="form-label">
                                Government Entity Legal Name
                            </label>

                            <input type="text" required="required" class="form-control" name="company_name" value="{{ companyName }}" />
                        </div>
                    {% endif %}

                    <div class="form-group {% if not company.nickname %}d-none{% endif %}" id="dba-name-field">
                        <label class="form-label">
                            Doing Business As
                        </label>

                        <input type="text" class="form-control" name="nickname" value="{{ app.request.request.get('nickname')|default(company.nickname) }}" />
                    </div>

                    <div class="form-group">
                        <div class="row">
                            <div class="col-sm-6">
                                <label class="form-label mb-1">
                                    {{ 'labels.address_line1'|trans }}
                                </label>

                                <input type="text" required="required" class="form-control" name="address1" value="{{ app.request.request.get('address1')|default(company.address1) }}" />
                            </div>
                            <div class="col-sm-6">
                                <label class="form-label mb-1">
                                    {{ 'labels.address_line2'|trans }}
                                </label>

                                <input type="text" class="form-control" name="address2" value="{{ app.request.request.get('address2')|default(company.address2) }}" />
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="row">
                            <div class="col-sm-4">
                                <label class="form-label mb-1">
                                    {{ 'labels.address_city'|trans }}
                                </label>

                                <input type="text" required="required" class="form-control" name="city" value="{{ app.request.request.get('city')|default(company.city) }}" />
                            </div>
                            <div class="col-sm-4">
                                <label class="form-label mb-1">
                                    {{ 'labels.address_state'|trans }}
                                </label>

                                {% set selectedCountry = app.request.request.get('country')|default(company.country) %}
                                {% set selectedState = app.request.request.get('state')|default(company.state) %}
                                {% for country in countries %}
                                    {% if country.states is defined %}
                                        <div id="states-{{ country.code }}" class="state-selector d-none">
                                            <select class="form-select" name="state" required="required" disabled="disabled">
                                                <option value="">-- Select One</option>
                                                {% for state in country.states %}
                                                    <option value="{{ state.code }}" {% if selectedState == state.code %}selected="selected"{% endif %}>{{ state.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                                <div id="states-default" class="state-selector d-none">
                                    <input type="text" class="form-control" name="state" value="{{ selectedState }}" disabled="disabled" />
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <label class="form-label mb-1">
                                    {{ 'labels.address_postal_code'|trans }}
                                </label>

                                <input type="text" class="form-control" name="postal_code" value="{{ app.request.request.get('postal_code')|default(company.postal_code) }}" />
                            </div>
                        </div>
                    </div>

                    {% if not company.country %}
                        <div class="form-group">
                            <div class="row">
                                <div class="col-sm-6">
                                    <label class="form-label mb-1">
                                        {{ 'labels.address_country'|trans }}
                                    </label>

                                    <select class="form-select" name="country" required="required" id="country-selector">
                                        <option value="">-- Select One</option>
                                        {% for country in countries %}
                                            <option value="{{ country.code }}" {% if country.code == selectedCountry %}selected="selected"{% endif %}>{{ country.country }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <input type="hidden" id="selected-country" value="{{ selectedCountry }}" />
                    {% endif %}
                    <hr class="my-5">

                    <div class="form-group">
                        <div class="row">
                            {% if not company.industry %}
                                <div class="col-sm-6">
                                    <label class="form-label mb-1">
                                        Industry
                                    </label>

                                    <select class="form-select" name="industry" required="required">
                                        {% set selectedIndustry = app.request.request.get('industry')|default(company.industry) %}
                                        {% set industries = [
                                            'Academia',
                                            'Accounting',
                                            'Animal care',
                                            'Agriculture',
                                            'Apparel',
                                            'Banking',
                                            'Beauty and Cosmetics',
                                            'Biotechnology',
                                            'Business Services',
                                            'Chemicals',
                                            'Communications',
                                            'Construction',
                                            'Consulting',
                                            'Distribution',
                                            'Education',
                                            'Electronics',
                                            'Energy',
                                            'Engineering',
                                            'Entertainment',
                                            'Environmental',
                                            'Finance',
                                            'Food and Beverage',
                                            'Government and Public services',
                                            'Grant and Fundraising',
                                            'Healthcare',
                                            'Hospitality',
                                            'HR and Recruitment',
                                            'Insurance',
                                            'Legal Services',
                                            'Machinery',
                                            'Manufacturing',
                                            'Marketing and Advertising',
                                            'Media',
                                            'Medical Equipment and Supplies',
                                            'Not for profit',
                                            'Oil and Gas',
                                            'Pharmaceutical',
                                            'Real Estate',
                                            'Recreation',
                                            'Recruitment',
                                            'Research (non-academic)',
                                            'Retail',
                                            'Security Services',
                                            'Shipping',
                                            'Software and IT',
                                            'Technology Hardware',
                                            'Telecommunications',
                                            'Transportation',
                                            'Travel',
                                            'Utilities',
                                            'Other',
                                        ] %}
                                        <option value="">-- Select One</option>
                                        {% for industry in industries %}
                                            <option value="{{ industry }}" {% if industry == selectedIndustry %}selected="selected"{% endif %}>{{ industry }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            {% else %}
                                <input type="hidden" name="industry" value="{{ company.industry }}" />
                            {% endif %}
                        </div>
                    </div>

                    <hr class="my-5">

                    <div class="nav row align-items-center justify-content-center text-center" role="tablist">
                        <div class="col">
                            {% if previousStep %}
                                <a href="{{ path('onboarding_step', {step: previousStep, companyId: app.request.attributes.get('companyId')}) }}" class="btn btn-lg btn-white">
                                    Previous
                                </a>
                            {% endif %}
                        </div>
                        <div class="col">
                            <h6 class="text-uppercase text-muted mb-0">
                                Step {{ currentStepNumber }} of {{ totalSteps }}
                            </h6>
                        </div>
                        <div class="col">
                            <button type="submit" class="btn btn-lg btn-primary" id="theFormSubmit">
                                Continue
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(function () {
            var $countrySelector = $('#country-selector');
            $countrySelector.change(selectCountry);

            selectCountry();

            function selectCountry() {
                var country;
                if ($countrySelector.length > 0) {
                    country = $countrySelector.find('option:selected').val();
                } else {
                    country = $('#selected-country').val();
                }

                var $stateSelector;
                $('.state-selector').addClass('d-none');
                $('.state-selector input, .state-selector select').attr('disabled', 'disabled');

                var $stateList = $('#states-'+country);
                if ($stateList.length > 0) {
                    $stateSelector = $stateList;
                } else {
                    $stateSelector = $('#states-default');
                }

                $stateSelector.removeClass('d-none');
                $('input, select', $stateSelector).removeAttr('disabled');
            }

            $('#dbaCheck').change(function () {
                if ($(this).is(':checked')) {
                    $('#dba-name-field').removeClass('d-none');
                } else {
                    $('#dba-name-field').addClass('d-none');
                }
            });

            $('#theForm').on('submit', function () {
                $('#theFormSubmit').attr('disabled', 'disabled');
                return true;
            });
        });
    </script>

{% endblock %}
